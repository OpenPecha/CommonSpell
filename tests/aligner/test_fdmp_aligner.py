from pathlib import Path
from CommonSpell.aligners.fdmp import FDMPaligner




def test_fdmp_aligner():

    token_strings = [
        '+,-./0123456789678-3',
        ',-./012345678:678-3',
        ';-./456789678-3'
    ]
    token_lists = [
        [
        [0, 5, 1, '༄༅། །', 0], [5, 10, 1, 'རིགས་', 0], [10, 12, 1, 'པ་', 0], [12, 17, 1, 'བསྟན་', 0], 
        [17, 20, 1, 'པར་', 0], [20, 23, 1, 'བྱ་', 0], [23, 27, 1, 'བའི་', 0], [27, 31, 1, 'ཕྱིར', 0], 
        [31, 33, 1, '། ', 0], [33, 36, 1, 'དེ་', 0], [36, 40, 1, 'ཉིད་', 0], [40, 44, 1, 'ཀྱི་', 0], 
        [44, 48, 1, 'བཀྲ་', 0], [48, 52, 1, 'ཤིས་', 0], [52, 56, 1, 'ཀུན་', 0], [56, 60, 1, 'གྱི་', 0], 
        [60, 64, 1, 'བཀྲ་', 0], [64, 68, 1, 'ཤིས་', 0], [68, 69, 1, 'པ', 0], [69, 70, 1, '།', 0]
        ],
        [
        [0, 5, 1, 'རིགས་', 0], [5, 7, 1, 'པ་', 0], [7, 12, 1, 'བསྟན་', 0], 
        [12, 15, 1, 'པར་', 0], [15, 18, 1, 'བྱ་', 0], [18, 22, 1, 'བའི་', 0], [22, 26, 1, 'ཕྱིར', 0], 
        [26, 28, 1, '། ', 0], [28, 31, 1, 'དེ་', 0], [31, 35, 1, 'ཉིད་', 0], [35, 39, 1, 'ཀྱི་', 0], 
        [39, 43, 1, 'བཀྲ་', 0], [43, 47, 1, 'ཤིས་', 0], [47, 51, 1, 'ཀུད་', 0], [51, 55, 1, 'གྱི་', 0], 
        [55, 59, 1, 'བཀྲ་', 0], [59, 63, 1, 'ཤིས་', 0], [63, 64, 1, 'པ', 0], [64, 65, 1, '།', 0]
        ],
        [
        [0, 5, 1, 'རིག་', 0], [5, 7, 1, 'པ་', 0], [7, 12, 1, 'བསྟན་', 0], 
        [12, 15, 1, 'པར་', 0], [15, 18, 1, 'དེ་', 0], [18, 22, 1, 'ཉིད་', 0], [22, 26, 1, 'ཀྱི་', 0], 
        [26, 30, 1, 'བཀྲ་', 0], [30, 34, 1, 'ཤིས་', 0], [34, 38, 1, 'ཀུན་', 0], [38, 42, 1, 'ཀྱི་', 0], 
        [42, 46, 1, 'བཀྲ་', 0], [46, 50, 1, 'ཤིས་', 0], [50, 51, 1, 'པ', 0], [51, 52, 1, '།', 0]
        ]
    ]

    expected_matrix = [
        [[0, 10, 1, '༄༅། །རིགས་', 0], [0, 5, 1, 'རིགས་', 0], [0, 5, 1, 'རིག་', 0]],
        [[10, 12, 1, 'པ་', 0], [5, 7, 1, 'པ་', 0], [5, 7, 1, 'པ་', 0]],
        [[12, 17, 1, 'བསྟན་', 0], [7, 12, 1, 'བསྟན་', 0], [7, 12, 1, 'བསྟན་', 0]],
        [[17, 33, 1, 'པར་བྱ་བའི་ཕྱིར། ', 0], [12, 28, 1, 'པར་བྱ་བའི་ཕྱིར། ', 0], [12, 15, 1, 'པར་', 0]],
        [[33, 36, 1, 'དེ་', 0], [28, 31, 1, 'དེ་', 0], [15, 18, 1, 'དེ་', 0]],
        [[36, 40, 1, 'ཉིད་', 0], [31, 35, 1, 'ཉིད་', 0], [18, 22, 1, 'ཉིད་', 0]],
        [[40, 44, 1, 'ཀྱི་', 0], [35, 39, 1, 'ཀྱི་', 0], [22, 26, 1, 'ཀྱི་', 0]],
        [[44, 48, 1, 'བཀྲ་', 0], [39, 43, 1, 'བཀྲ་', 0], [26, 30, 1, 'བཀྲ་', 0]],
        [[48, 52, 1, 'ཤིས་', 0], [43, 47, 1, 'ཤིས་', 0], [30, 34, 1, 'ཤིས་', 0]],
        [[52, 60, 1, 'ཀུན་གྱི་', 0], [47, 55, 1, 'ཀུད་གྱི་', 0], [34, 42, 1, 'ཀུན་ཀྱི་', 0]],
        [[60, 64, 1, 'བཀྲ་', 0], [55, 59, 1, 'བཀྲ་', 0], [42, 46, 1, 'བཀྲ་', 0]],
        [[64, 68, 1, 'ཤིས་', 0], [59, 63, 1, 'ཤིས་', 0], [46, 50, 1, 'ཤིས་', 0]],
        [[68, 69, 1, 'པ', 0], [63, 64, 1, 'པ', 0], [50, 51, 1, 'པ', 0]],
        [[69, 70, 1, '།', 0], [64, 65, 1, '།', 0], [51, 52, 1, '།', 0]]
    ]

    aligner = FDMPaligner()
    token_matrix = aligner.get_alignment_matrix(token_strings, token_lists)
    Path('./tests/data/matrix.txt').write_text(str(token_matrix))
    
    assert expected_matrix == token_matrix
    

# test_fdmp_aligner()
